## 符号约定
### 旋转矩阵
$R_1(\varphi)=\left\[\begin{matrix}1 & 0 & 0\cr0 & \cos\varphi & \sin\varphi\cr0 & -\sin\varphi & \cos\varphi\end{matrix}\right\]$（表示标架绕 $x$ 轴旋转 $\varphi$，或地球绕 $x$ 轴旋转 $-\varphi$）

$R_2(\varphi)=\left\[\begin{matrix}\cos\varphi & 0 & -\sin\varphi\cr0 & 1 & 0\cr\sin\varphi & 0 & \cos\varphi\end{matrix}\right\]$（表示标架绕 $y$ 轴旋转 $\varphi$，或地球绕 $y$ 轴旋转 $-\varphi$）

$R_3(\varphi)=\left\[\begin{matrix}\cos\varphi & \sin\varphi & 0\cr-\sin\varphi & \cos\varphi & 0\cr0 & 0 & 1\end{matrix}\right\]$（表示标架绕 $z$ 轴旋转 $\varphi$，或地球绕 $z$ 轴旋转 $-\varphi$）

### 单位
单位约定与国际单位制规范文本一致，以下提及部分。

$\text{s}$ 表示秒（second），定义为 $1\kern{3 mu}\text{s}=\dfrac{9192631770}{\Delta\nu_\text{Cs}}$（其中 $\Delta\nu_\text{Cs}$ 是铯-133 原子不受扰动的基态超精细能级跃迁频率），是量纲时间（time，符号为 $\text{T}$）对应的基本单位。

$\text{m}$ 表示米（metre），定义为 $1\kern{3 mu}\text{m}=\dfrac{c}{299792458}\kern{3 mu}\text{s}$（其中 $c$ 是真空光速），是量纲长度（length，符号为 $\text{L}$）对应的基本单位。

$\text{rad}$ 表示弧度（radian），定义为 $\text{rad}=\kern{0 mu}^\text{m}\kern{-3 mu}/\kern{-3 mu}_\text{m}$，用于度量平面角。

$\text{min}$ 表示分（minute），定义为 $1\kern{3 mu}\text{min}=60\kern{3 mu}\text{s}$，用于度量时间。

$\text{h}$ 表示（小）时（hour），定义为 $1\kern{3 mu}\text{h}=60\kern{3 mu}\text{min}=3600\kern{3 mu}\text{s}$，用于度量时间。

$\text{d}$ 表示天（日）（day），定义为 $1\kern{3 mu}\text{d}=24\kern{3 mu}\text{h}=86400\kern{3 mu}\text{s}$，用于度量时间。

$^\circ$ 表示度（degree），定义为 $1^\circ=\dfrac{\pi}{180}\kern{3 mu}\text{rad}$，用于度量平面角。

$'$ 表示（角）分（(arc)minute），定义为 $1'=\dfrac{1}{60}^\circ=\dfrac{\pi}{10800}\kern{3 mu}\text{rad}$，用于度量平面角。

$''$ 或 $\text{as}$ 表示（角）秒（(arc)second），定义为 $1''=1\kern{3 mu}\text{as}=\dfrac{1}{60}'=\dfrac{\pi}{648000}\kern{3 mu}\text{rad}$，用于度量平面角。

$\mu\text{as}$ 表示微角秒（microarcsecond），定义为 $1\kern{3 mu}\mu\text{as}=10^{-6}\kern{3 mu}\text{as}=\dfrac{\pi}{648000000000}\kern{3 mu}\text{rad}$，用于度量平面角。

## Julius 日数及其衍生
### Julius 日数
从零时区的倒推 Julius 历公元前 4713 年 1 月 1 日（即倒推公历公元前 4714 年 11 月 24 日）正午（12:00:00）起算的整天数称为 Julius 日数（Julian day number, JDN）。

例如，当且仅当时刻位于区间 \[公元前 4714 年 11 月 24 日 12:00:00（零时区）, 公元前 4714 年 11 月 25 日 12:00:00（零时区）) 内时 JDN 为 0。

### Julius 日
令当前 JDN 对应的起始时刻为 0，下一 JDN 对应的起始时刻为 1 作关于时刻的一次函数，则该函数即给出 $\[0,1)$ 范围内的实数。将其加上 JDN，得到的实数便是 Julius 日（Julian date, JD）。

可以看出，JD 的整数部分是 JDN，而小数部分对应的是一日内的进度。

### 约化 Julius 日
JD 有两个问题：一个是起点过于久远，于是表示当今时刻数值就显得较大；另一个是整数对应的时刻是零时区的 12:00:00 而非 00:00:00，整数部分就与零时区对应时刻下的日期部分并不一致。

前者可以减去大整数解决，后者可以减去 0.5 解决。因此将 JD 减去 2400000.5，得到约化 Julius 日（Modified Julian date, MJD）。

$\text{MJD}=\text{JD}-2400000.5$

## 因研究地球而生的参考系
### 天球参考系与地球参考系
天球参考系（Celestial reference system, CRS）是标架相对于宇宙遥远物质固定的准惯性参考系，地球参考系（Terrestrial reference system, TRS）是标架随地球一同旋转的参考系。

当然，这种概念约束不过限定在标架上面而已，对原点的情形则没有限制。

### 按原点分类
如果将常见的 CRS 与 TRS 按原点分类，则可以细分为三种：
- 质心天球参考系（Barycentric Celestial Reference System, BCRS）
- 地心天球参考系（Geocentric Celestial Reference System, GCRS）
- 地心地球参考系（Geocentric Terrestrial Reference System, GTRS）

质心地球参考系就不太有用的必要。

### 协议天球参考系与协议地球参考系
出于交流的需要，自然需要约定参考系的参数来共同应用。由此得到协议天球参考系（Conventional celestial reference system, CCRS）与协议地球参考系（Conventional terrestrial reference system, CTRS）。

就「协议」而言倒不见得世界通用，只有两方用也能叫协议。

### 国际天球参考系与国际地球参考系
国际地球自转和参考系服务（International Earth Rotation and Reference Systems Service, IERS）在 CRS 方面提出了国际天球参考系（International Celestial Reference System, ICRS）并被国际天文学联合会（International Astronomical Union, IAU）采用，在 TRS 方面提出了国际地球参考系（International Terrestrial Reference System, ITRS）。

于是，ICRS 与 ITRS 就各成为世界范围内通用的 CCRS 与 CTRS。

ICRS 与 ITRS 各是特殊的 BCRS 与 GTRS。

需要指出，如果没有特别说明，使用术语 BCRS 与 GCRS 时总是默认标架定向与 ICRS 一致——这是 IAU 2006 决议 B2 的规定。

### 在 ITRS 与 GCRS 间转换
这里介绍 ITRS 转至 GCRS 的过程，反过来的情形施逆变换即可。

本节中时刻参数定义为 $t=\dfrac{\text{TT}-\text{J2000.0}}{36525\kern{3 mu}\text{d}$。

TT 是后续章节将提到的地球时，J2000.0 是地球时的 2000 年 1 月 1 日 12:00:00（以 JD 计便为 2451545.0）。

了解这样的约定，便可用 JD 更明确地表述时刻参数。

$t=\dfrac{\text{JD}_\text{TT}-2451545.0}{36525}$

另外约定 $t_0$ 代表 J2000.0 时的 $t$，于是 $t_0=0$。

#### 极移
第一步，将 ITRS 变换至地球中间参考系（Terrestrial Intermediate Reference System, TIRS）。

TIRS 的 $z$ 轴指向天球中间极（Celestial Intermediate Pole, CIP），且 $x$ 轴指向地球中间零点（Terrestrial Intermediate Origin, TIO）。

$\text{\[TIRS\]}=W(t)\text{\[ITRS\]}$

$W(t)$ 的定义如下。

$W(t)=R_3(-s')R_2(x_p)R_1(y_p)$

$(x_p,y_p)$ 是 ITRS 中 CIP 的极点坐标。$x_p$ 与 $y_p$ 之正向依照 IERS 约定，分别指向 0° 与 90°W 经线。

这样 $z$ 轴的确指向了 CIP；但是就这一个条件并不足以确定参考系，因为 $x$ 轴与 $y$ 轴的方向未定。

因此还要用到 $x$ 轴指向 TIO 的条件。$s'$ 是 TIO 定位角，用来将 $x$ 轴旋转至 TIO。其定义如下。

$\displaystyle s'(t)=\dfrac{1}{2}\left.\int_{t_0}^{T}\left(x_p\dfrac{dy_p}{dt}-\dfrac{dx_p}{dt}y_p\right)dt\right\|\_{T=t}$

这样就把极移处理完了。

#### 自转
让 $z$ 轴指向 CIP 后，$z$ 轴也就成了地球的自转轴。

第二步，将 TIRS 变换至天球中间参考系（Celestial Intermediate Reference System, CIRS）。

CIRS 的 $z$ 轴指向 CIP，且 $x$ 轴指向天球中间零点（Celestial Intermediate Origin, CIO）。

$\text{\[CIRS\]}=R(t)\text{\[TIRS\]}$

$R(t)$ 的定义如下。

$R(t)=R_3(-\text{ERA})$

$\text{ERA}$ 是地球自转角，即 CIO 与 TIO 在 CIP 赤道上的夹角。注意到 R_3 的变量是 $\text{ERA}$ 的相反数——正如最开始的符号约定所言，$R_3(\varphi)$ 表示地球绕 $z$ 轴旋转 $-\varphi$。

自转也处理完了。

#### 岁差和章动
设 $(X,Y,Z)$ 是 GCRS 下原点到 CIP 的方向向量。

第三步，将 CIRS 变换至 GCRS。

$\text{\[GCRS\]}=Q(t)\text{\[CIRS\]}$

$Q(t)$ 的定义如下。

$Q(t)=R_3(-E)R_2(-d)R_3(E)R_3(s)$

$d$ 与 $E$ 可以依下式确定。

$(X,Y,Z)=(\sin d\cos E,\sin d\sin E,\cos d)$

虽说就是个球坐标的反解……

$s$ 是 CIO 定位角。其定义如下。

$\displaystyle s(t)=-\left.\int_{t_0}^{T}\dfrac{X(t)\dfrac{dY(t)}{dt}-Y(t)\dfrac{dX(t)}{dt}}{1+Z(t)}dt\right\|\_{T=t}-\left(\sigma_0N_0-\Sigma_0N_0\right)$

需要注意的是，天文学约定 $AB$ 表示以地心为顶点，两边各过 $A$ 与 $B$ 两点的角的大小，称其为 $A$ 与 $B$ 相对于地心的角距离。

其中 $\sigma_0$ 是 $t_0$ 时的 CIO，$\Sigma_0$ 是 GCRS 的 $x$ 零点，$N_0$ 是 $t_0$ 时 CIP 赤道在 GCRS 赤道上的升交点。

$t_0$ 依照 IERS 约定而同节首所言，代表 J2000.0 时的 $t$。IERS 还约定，该算法在其强制实施时点（2003 年 1 月 1 日）的计算结果应当同旧算法保持一致。由是，经过计算，积分常数 $s_0=-(\sigma_0N_0-\Sigma_0N_0)$ 确定为 $+94\kern{3 mu}\mu\text{as}$。

岁差和章动也处理了。

因此总变换可以写成下式。

$\text{\[GCRS\]}=Q(t)R(t)W(t)\text{\[ITRS\]}$

## 世界时
### 太阳日与恒星日
观察太阳照射的变化以感知并测量时间流逝是自古以来便为人——其实植物也会——采用的方法，典例有日晷。太阳高度角达到极大值的时刻称为太阳正午，相邻太阳正午之间的时间是一个太阳日。

直接观测得到的太阳日便是视太阳日。

不过中学物理和中学地理都有讲到 Kepler 三定律，也就能看出地球公转的速率并不均匀。而且地轴有着约 23 度 26 分的倾角（黄赤交角），于是日影的运行速率也不均匀。这样视太阳日便有不小的波动。

### 用时间量纲计量角度
如果要用这类天文现象计量时间流逝的话就免不了测量角度。

从历史的角度来看，「天」最初指地球自转一周的时间。要贴近历史上的这个定义，时间 $1\kern{3 mu}\text{d}$ 就要对应角度 $360^\circ$。

由此，时角比也就成为 $\dfrac{1\kern{3 mu}\text{d}}{360^\circ}=\dfrac{1}{15}\kern{3 mu}^\text{s}\kern{-3 mu}/\kern{-3 mu}_\text{as}$。这个比例系数在后文相当常用。

### GMT 的混乱历史
相信诸位或多或少会在时间相关的环境看到「GMT」这个词，它的全称是「Greenwich Mean Time」。

Greenwich 平均时间（Greenwich Mean Time, GMT）到底是什么呢？我也不知道——别笑，因为我确实不知道。

GMT 本身就是含义十分模糊的词语。从字面上看，GMT 是 Greenwich 经线上的平均时，确切而言是平太阳时。但是现在所讲的 GMT 不能这样简单理解。

这个词语的含义为何会含混不清呢？自然是因为它有着混乱的历史。

### UT0
### UT1
地方时的差异是地球自转的产物，这是计算世界时要考虑经度的原因。但是，地球的自转轴并不相对于地球静止，也就是极移现象。

计算 UT0 时用的经度是平均经度（可以认为是 ITRS 下的经度），没有考虑极移。如果要考虑极移，就得将南北方向置于真正的自转轴上，重新折算瞬时经度才行。

那就把 $z$ 轴建在自转轴上。回想起来，TIRS 便是如此。

$\text{\[TIRS\]}=W(t)\text{\[ITRS\]}=R_3(-s')R_2(x_p)R_1(y_p)\text{\[ITRS\]}$

当然，TIO 定位角并不需要考虑。一方面它本身非常小；另一方面我们的目的是把时刻统一起来，而它对经度差没有影响——大家都差那么多就相当于都没差。

因此考虑 $R_2(x_p)R_1(y_p)$ 就足够了。不妨用下标 $i$ 表示瞬时经纬度，无下标表示平均经纬度。寻找 $(\varphi_i,\lambda_i)$ 与 $(\varphi,\lambda)$ 的关系即可。

$\begin{aligned}\left\[\begin{matrix}\cos\varphi_i\cos\lambda_i\cr\cos\varphi_i\sin\lambda_i\cr\sin\varphi_i\end{matrix}\right\]&=R_2(x_p)R_1(y_p)\left\[\begin{matrix}\cos\varphi\cos\lambda\cr\cos\varphi\sin\lambda\cr\sin\varphi\end{matrix}\right\]\cr&=\left\[\begin{matrix}\cos x_p & 0 & -\sin x_p\cr0 & 1 & 0\cr\sin x_p & 0 & \cos x_p\end{matrix}\right\]\left\[\begin{matrix}1 & 0 & 0\cr0 & \cos y_p & \sin y_p\cr0 & -\sin y_p & \cos y_p\end{matrix}\right\]\left\[\begin{matrix}\cos\varphi\cos\lambda\cr\cos\varphi\sin\lambda\cr\sin\varphi\end{matrix}\right\]\cr&=\left\[\begin{matrix}\cos x_p\cos\varphi\cos\lambda+\sin x_p\sin y_p\cos\varphi\sin\lambda-\sin x_p\cos y_p\sin\varphi\cr\cos y_p\cos\varphi\sin\lambda+\sin y_p\sin\varphi\cr\sin x_p\cos\varphi\cos\lambda-\cos x_p\sin y_p\cos\varphi\sin\lambda+\cos x_p\cos y_p\sin\varphi\end{matrix}\right\]\end{aligned}$

……大抵不会有别的人像我这样蠢到手算了。

于是 $\lambda_i=\operatorname{atan2}(\cos y_p\cos\varphi\sin\lambda+\sin y_p\sin\varphi,\cos x_p\cos\varphi\cos\lambda+\sin x_p\sin y_p\cos\varphi\sin\lambda-\sin x_p\cos y_p\sin\varphi)$。

令 $\Delta\lambda=\lambda_i-\lambda$，则得到经度修正量。应该怎么用呢？

设测到的地方时为 $T$。最初计算世界时的时候以为观测站的经度就是 $\lambda$，因此算出来的世界时 $\text{UT0}=T-k\lambda$，其中 $k$ 是时间与转角之比。

而实际上的世界时——记为 $\text{UT1}$——应该是 $\text{UT1}=T-k\lambda_i=T-k(\lambda+\Delta\lambda)=(T-k\lambda)-k\Delta\lambda=\text{UT0}-k\Delta\lambda$。

$\text{UT1}=\text{UT0}-k\Delta\lambda$

接下来确定比例系数 $k$。

虽然时角比是 $\dfrac{1}{15}\kern{3 mu}^\text{s}\kern{-3 mu}/\kern{-3 mu}_\text{as}$，但是经度差对应着恒星时差，而 UT 是平太阳时体系下的，因此还要再除以 $1.002737909$。

$k=\dfrac{1}{15\times1.002737909}\kern{3 mu}^\text{s}\kern{-3 mu}/\kern{-3 mu}_\text{as}$

另外 $\Delta\lambda$ 的表达式过于复杂，也应该尽可能在保证精度的同时简化。

注意到 $\displaystyle\lim_{(x_p,y_p)\rightarrow(0,0)}\Delta\lambda=0$（至少在 $\lambda\ne\pi$ 时如此），于是 $(x_p,y_p)$ 充分接近 $(0,0)$ 时将有 $\Delta\lambda=\arctan\tan(\lambda_i-\lambda)$。

令 $(\alpha,\beta)=(\cos y_p\cos\varphi\sin\lambda+\sin y_p\sin\varphi,\cos x_p\cos\varphi\cos\lambda+\sin x_p\sin y_p\cos\varphi\sin\lambda-\sin x_p\cos y_p\sin\varphi)$，则 $\tan\lambda_i=\dfrac{\alpha}{\beta}$。

$\Delta\lambda=\arctan\tan(\lambda_i-\lambda)=\arctan\dfrac{\tan\lambda_i-\tan\lambda}{1+\tan\lambda_i\tan\lambda}=\arctan\dfrac{\alpha-\beta\tan\lambda}{\beta+\alpha\tan\lambda}$

将 $\alpha$ 与 $\beta$ 按 $x_p$ 与 $y_p$ 展开成 Taylor 多项式，阶数够用就行。

$\alpha=\cos\varphi\sin\lambda+y_p\sin\varphi+o\left(\sqrt{x_p^2+y_p^2}\right)$

$\beta=\cos\varphi\cos\lambda-x_p\sin\varphi+o\left(\sqrt{x_p^2+y_p^2}\right)$

「所以你就只展开到一阶？」

嘛人一懒就是这样的。

$\dfrac{\alpha-\beta\tan\lambda}{\beta+\alpha\tan\lambda}=\dfrac{(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi+o\left(\sqrt{x_p^2+y_p^2}\right)}{1-(x_p\cos\lambda-y_p\sin\lambda)\tan\varphi+o\left(\sqrt{x_p^2+y_p^2}\right)}=(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi+o\left(\sqrt{x_p^2+y_p^2}\right)$

……这一部分仍然是手算的，应该没有算错。

$\Delta\lambda=\arctan\dfrac{\alpha-\beta\tan\lambda}{\beta+\alpha\tan\lambda}=(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi+o\left(\sqrt{x_p^2+y_p^2}\right)$

这样 $(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi$ 便成为 $\Delta\lambda$ 关于变元 $(x_p,y_p)$ 在 $(0,0)$ 附近的一阶近似，于是可以直接把它当作 $\Delta\lambda$。

$\Delta\lambda=(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi$

$\text{UT1}=\text{UT0}-\dfrac{1}{15\times1.002737909}\kern{3 mu}^\text{s}\kern{-3 mu}/\kern{-3 mu}_\text{as}\kern{3 mu}(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi$

最终得到了 UT0 的极移修正版本，也就是 UT1。通常所说的 UT 便是指 UT1。

值得注意的是，[Bulletin Horaire 1955](https://www.ucolick.org/~sla/leapsecs/BHs4n4.pdf) 给出的公式和上面写的并不一样。

$\Delta\lambda=\lambda_i-\lambda_m=\dfrac{1}{15}(x\sin\lambda_m-y\cos\lambda_m)\tan\varphi_m$

$\text{TU1}=\text{TU0}+\Delta\lambda$

因为当时国际时间局（Bureau International de l'Heure, BIH）的约定是西经为正，所以当中出现的 $\lambda$ 其实相当于现在的 $-\lambda$。这个 $\Delta\lambda$（忽略量纲差异的话）也就成了之前所述 $\Delta\lambda$ 的相反数。

将 $\lambda$ 全部换成 $-\lambda$ 试试。

$\Delta(-\lambda)=-\lambda_i-(-\lambda_m)=\dfrac{1}{15}(x\sin(-\lambda_m)-y\cos(-\lambda_m))\tan\varphi_m$

$\text{TU1}=\text{TU0}+\Delta(-\lambda)$

然后化简。

$\Delta\lambda=\lambda_i-\lambda_m=\dfrac{1}{15}(x\sin\lambda_m+y\cos\lambda_m)\tan\varphi_m$

$\text{TU1}=\text{TU0}-\Delta\lambda$

忽略量纲差异的话，可以看出并没有区别。

由于 UT1 才是现今常用的 UT（实际上 UT0 也不再使用），书写公式时通常写成 UT0 减去 UT1 的形式。

$\text{UT0}-\text{UT1}=\dfrac{1}{15\times1.002737909}\kern{3 mu}^\text{s}\kern{-3 mu}/\kern{-3 mu}_\text{as}\kern{3 mu}(x_p\sin\lambda+y_p\cos\lambda)\tan\varphi$（其中 CIP 坐标 $x_p$ 与 $y_p$ 之正向依照 IERS 约定，分别指向 0° 与 90°W 经线）

### UT2
地球自转的状况其实也和季节有关。

姑且说一种比较扯而又不是没可能的原因。冬天积雪、夏天融雪会使地球的转动惯量改变，从而影响自转。当然，听起来有点「COVID-19 影响男同屁眼从而透过做爱时爆炸致死的方法根除男同性恋」的味道，不过并不是那么不靠谱。大气压、地下水应该也算可能的原因。

UT2 便是在 UT1 的基础上用经验公式加偏移来处理这个问题。公式的系数倒是变过几次。

先放一下 [Bulletin Horaire 1955](https://www.ucolick.org/~sla/leapsecs/BHs4n4.pdf) 中规定的 1956 年用公式。

$\Delta T_s=+0^\text{s},022\sin2\pi t-0^\text{s},017\cos2\pi t-0^\text{s},007\sin4\pi t+0^\text{s},006\cos4\pi t$

下标大抵是指 saisonnière（季节的）。倒也没讲清楚 $t$ 指什么。

UT0、UT1 与 UT2 三者间的关系用连等式 $\text{TU2}=\text{TU0}+\Delta\lambda+\Delta T_s=\text{TU1}+\Delta T_s$ 表示。

最终确定的公式是下面这个。

$\text{UT2}-\text{UT1}=(0.022\sin2\pi T-0.012\cos2\pi T-0.006\sin4\pi T+0.007\cos4\pi T)\kern{3 mu}\text{s}$（其中 $T=2000.000+\dfrac{\text{MJD}-51544.03}{365.2422}$）

现在很少使用 UT2 了，不过 IERS 公告 A 至今还在开头提供 UT2 的公式。

## 地球时
$\text{TT}=\text{TAI}+32.184\kern{3 mu}\text{s}$
